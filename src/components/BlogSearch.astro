---
// 博客搜索组件
---

<div class="blog-search-container mb-8">
  <div class="relative max-w-md mx-auto">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
      <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </div>
    <input 
      type="text" 
      id="blogSearch"
      placeholder="搜索文章..."
      class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
    />
    <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
      <button 
        type="button" 
        id="clearSearch"
        class="text-gray-400 hover:text-gray-600 focus:outline-none hidden"
      >
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>
  
  <!-- 搜索结果提示 -->
  <div id="searchResults" class="mt-4 text-center text-gray-600 hidden">
    <p id="searchResultsText"></p>
  </div>
  
  <!-- 无结果提示 -->
  <div id="noResults" class="mt-8 text-center hidden">
    <div class="bg-gray-50 rounded-lg p-8">
      <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.291-1.002-5.824-2.582M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"></path>
      </svg>
      <h3 class="text-lg font-medium text-gray-900 mb-2">未找到相关文章</h3>
      <p class="text-gray-600 mb-4">尝试使用不同的关键词或浏览我们的文章分类</p>
      <button 
        id="showAllPosts"
        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-blue-600 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
      >
        显示所有文章
      </button>
    </div>
  </div>
</div>

<script>
  // 博客搜索功能
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('blogSearch');
    const clearButton = document.getElementById('clearSearch');
    const searchResults = document.getElementById('searchResults');
    const searchResultsText = document.getElementById('searchResultsText');
    const noResults = document.getElementById('noResults');
    const showAllButton = document.getElementById('showAllPosts');
    const blogGrid = document.getElementById('blogGrid');
    const blogPosts = blogGrid ? blogGrid.querySelectorAll('.blog-post') : [];
    
    let searchTimeout;
    
    // 搜索功能
    function performSearch(query) {
      const searchTerm = query.toLowerCase().trim();
      let visibleCount = 0;
      
      blogPosts.forEach(post => {
        const title = post.querySelector('h2')?.textContent.toLowerCase() || '';
        const excerpt = post.querySelector('p')?.textContent.toLowerCase() || '';
        const category = post.getAttribute('data-category')?.toLowerCase() || '';
        
        const isMatch = title.includes(searchTerm) || 
                       excerpt.includes(searchTerm) || 
                       category.includes(searchTerm);
        
        if (isMatch || searchTerm === '') {
          post.style.display = 'block';
          visibleCount++;
        } else {
          post.style.display = 'none';
        }
      });
      
      // 更新搜索结果提示
      if (searchTerm === '') {
        searchResults.classList.add('hidden');
        noResults.classList.add('hidden');
      } else if (visibleCount === 0) {
        searchResults.classList.add('hidden');
        noResults.classList.remove('hidden');
      } else {
        searchResultsText.textContent = `找到 ${visibleCount} 篇相关文章`;
        searchResults.classList.remove('hidden');
        noResults.classList.add('hidden');
      }
      
      // 显示/隐藏清除按钮
      if (searchTerm) {
        clearButton.classList.remove('hidden');
      } else {
        clearButton.classList.add('hidden');
      }
    }
    
    // 搜索输入事件
    if (searchInput) {
      searchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          performSearch(e.target.value);
        }, 300); // 防抖动，300ms后执行搜索
      });
      
      // 回车键搜索
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          clearTimeout(searchTimeout);
          performSearch(e.target.value);
        }
      });
    }
    
    // 清除搜索
    if (clearButton) {
      clearButton.addEventListener('click', function() {
        searchInput.value = '';
        performSearch('');
      });
    }
    
    // 显示所有文章
    if (showAllButton) {
      showAllButton.addEventListener('click', function() {
        searchInput.value = '';
        performSearch('');
      });
    }
    
    // 与分类筛选的集成
    function integrateWithCategoryFilter() {
      const categoryButtons = document.querySelectorAll('.category-filter');
      
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          // 清除搜索
          searchInput.value = '';
          performSearch('');
        });
      });
    }
    
    // 初始化分类筛选集成
    integrateWithCategoryFilter();
  });
</script>

<style>
  .blog-search-container {
    position: relative;
    z-index: 10;
  }
  
  #blogSearch:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  .blog-post {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  .blog-post[style*="display: none"] {
    opacity: 0;
    transform: scale(0.95);
  }
</style>